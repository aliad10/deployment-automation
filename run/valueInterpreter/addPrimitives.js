const { callContract, resolveAddressFromDb, colors } = require("../core/runner");
require("dotenv").config();

// Minimal ABI for IValueInterpreter.addPrimitives(address[],address[],uint8[])
const VALUE_INTERPRETER_ABI = [
  "function addPrimitives(address[] primitives, address[] aggregators, uint8[] rateAssets) external",
];

// Static arrays for primitives, aggregators, and rate assets
const PRIMITIVES = [
  "0x0bc529c00C6401aEF6D220BE8C6Ea1667F6Ad93e",
  "0x0F5D2fB29fb7d3CFeE444a200298f468908cC942",
  "0x111111111117dC0aa78b770fA6A738034120C302",
  "0x3472A5A71965499acd81997a54BBA8D852C6E53d",
  "0x3845badAde8e6dFF049820680d1F14bD3903a5d0",
  "0x4da27a545c0c5B758a6BA100e3a049001de870f5",
  "0x4e3FBD56CD56c3e72c1403e103b45Db9da5B9D2B",
  "0x5A98FcBEA516Cf06857215779Fd812CA3beF1B32",
  "0x5f98805A4E8be255a32880FDeC7F6728C6568bA0",
  "0x6B3595068778DD592e39A122f4f5a5cF09C90fE2",
  "0x7D1AfA7B718fb893dB30A3aBc0Cfc608AaCfeBB0",
  "0x7Fc66500c84A76Ad7e9c93437bFc5Ac33E2DDaE9",
  "0x8E870D67F660D95d5be530380D0eC0bd388289E1",
  "0x9f8F72aA9304c8B593d555F12eF6589cC3A579A2",
  "0xba100000625a3754423978a60c9317c58a424e3D",
  "0xbC396689893D065F41bc2C6EcbeE5e0085233447",
  "0xc00e94Cb662C3520282E6f5717214004A7f26888",
  "0xc944E90C64B2c07662A292be6244BDf05Cda44a7",
  "0xD533a949740bb3306d119CC777fa900bA034cd52",
  "0xdd974D5C2e2928deA5F71b9825b8b646686BD200",
  "0xdeFA4e8a7bcBA345F687a2f1456F5Edd9CE97202",
  "0xec67005c4E498Ec7f55E092bd1d35cbC47C91892",
  "0xF629cBd94d3791C9250152BD8dfBDF380E2a3B9c",
  "0x030bA81f1c18d280636F32af80b9AAd02Cf0854e",
  "0x272F97b7a56a387aE942350bBC7Df5700f8a4576",
  "0x39C6b3e42d6A679d7D776778Fe880BC9487C2EDA",
  "0x5165d24277cD063F5ac44Efd447B27025e888f37",
  "0x8dAE6Cb04688C62d939ed9B68d32Bc62e49970b1",
  "0xa06bC25B5805d5F8d82847D191Cb4Af5A3e873E0",
  "0xa685a61171bb30d4072B338c80Cb7b2c865c873E",
  "0xaC6Df26a590F08dcC95D5a4705ae8abbc88509Ef",
  "0xB9D7CB55f463405CDfBe4E90a6D2Df01C2B92BF1",
  "0xc713e5E149D5D0715DcD1c156a020976e7E56B88",
  "0xFFC97d72E13E01096502Cb8Eb52dEe56f74DAD7B",
  "0x6F634c6135D2EBD550000ac92F494F9CB8183dAe",
  "0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599",
  "0x1f9840a85d5aF5bf1D1762F925BDADdC4201F984",
  "0x514910771AF9Ca656af840dff83E8264EcF986CA",
  "0xdAC17F958D2ee523a2206206994597C13D831ec7",
  "0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",
  "0xB8c77482e45F1F44dE1745F52C74426C631bDD52",
  "0x6B175474E89094C44Da98b954EedeAC495271d0F",
  "0xA0b73E1Ff0B80914AB6fe0444E65848C4C34450b",
  "0x4E15361FD6b4BB609Fa63C81A2be19d873717870",
  "0xe28b3B32B6c345A34Ff64674606124Dd5Aceca30",
  "0x320623b8E4fF03373931769A31Fc52A4E78B5d70",
  "0x69af81e73A73B40adF4f3d4223Cd9b1ECE623074",
  "0x64aa3364f17a4d01c6f1751fd97c2bd3d7e7f1d5",
  "0x853d955acef822db058eb8505911ed77f175b99e",
  "0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2",
  "0xD31a59c85aE9D8edEFeC411D448f90841571b89c",
  "0x50327c6c5a14DCaDE707ABad2E27eB517df87AB5",
  "0x582d872A1B094FC48F5DE31D3B73F2D9bE47def1",
  "0x95aD61b0a150d79219dCF64E1E6Cc01f0B64C4cE",
  "0x6982508145454Ce325dDbE47a25d4ec3d2311933",
  "0xfAbA6f8e4a5E8Ab82F62fe7C39859FA577269BE3",
  "0x77E06c9eCCf2E797fd462A92B6D7642EF85b0A44",
  "0xf34960d9d60be18cC1D5Afc1A6F012A723a28811",
  "0xaea46a60368a7bd060eec7df8cba43b7ef41ad85",
  "0x57e114B691Db790C35207b2e685D4A43181e6061",
  "0x3073f7aAA4DB83f95e9FFf17424F71D4751a3073",
  "0x4a220E6096B25EADb88358cb44068A3248254675",
  "0x68749665FF8D2d112Fa859AA293F07A622782F38",
  "0xd1d2Eb1B1e90B638588728b4130137D262C87cae",
  "0xB62132e35a6c13ee1EE0f84dC5d40bad8d815206",
  "0x45804880De22913dAFE09f4980848ECE6EcbAf78",
  "0xC18360217D8F7Ab5e7c516566761Ea12Ce7F9D72",
  "0x44ff8620b8cA30902395A7bD3F2407e1A091BF73",
  "0xE0f63A424a4439cBE457D80E4f4b51aD25b2c56C",
  "0x808507121B80c02388fAd14726482e061B8da827",
  "0x4d224452801ACEd8B2F0aebE155379bb5D594381",
  "0x467719aD09025FcC6cF6F8311755809d45a5E5f3",
  "0x58D97B57BB95320F9a05dC918Aef65434969c2B2",
  "0x626e8036deb333b408be468f951bdb42433cbf18",
  "0xec53bF9167f50cDEB3Ae105f56099aaaB9061F83",
  "0xbe0Ed4138121EcFC5c0E56B40517da27E6c5226B",
  "0x2dfF88A56767223A5529eA5960Da7A3F5f766406",
  "0x5aFE3855358E112B5647B952709E6165e1c1eEEe",
  "0xaA7a9CA87d3694B5755f213B5D04094b8d0F0A6F",
  "0x9Ce84F6A69986a83d92C324df10bC8E64771030f",
  "0x046EeE2cc3188071C02BfC1745A6b17c656e3f3d",
  "0xaaeE1A9723aaDB7afA2810263653A34bA2C21C7a",
  "0x39fBBABf11738317a448031930706cd3e612e1B9",
  "0x3593d125a4f7849a1b059e64f4517a86dd60c95d",
  "0x3c3a81e81dc49a522a592e7622a7e711c06bf354",
  "0x455e53cbb86018ac2b8092fdcd39d8444affc3f6",
  "0x112b08621e27e10773ec95d250604a041f36c582",
  "0x85f138bfEE4ef8e540890CFb48F620571d67Eda3",
  "0xB50721BCf8d664c30412Cfbc6cf7a15145234ad1",
];

const AGGREGATORS = [
  "0x7c5d4F8345e66f68099581Db340cd65B078C41f4",
  "0x82A44D92D6c329826dc557c5E1Be6ebeC5D5FeB9",
  "0x72AFAECF99C9d9C8215fF44C77B94B99C28741e8",
  "0x58921Ac140522867bf50b9E009599Da0CA4A2379",
  "0x35E3f7E558C04cE7eEE1629258EcbbA03B36Ec56",
  "0x6Df09E975c830ECae5bd4eD9d90f3A95a4f88012",
  "0xd962fC30A72A84cE50161031391756Bf2876Af5D",
  "0x4e844125952D32AcdF339BE976c98E22F6F318dB",
  "0x3D7aE7E594f2f2091Ad8798313450130d0Aba3a0",
  "0xe572CeF69f43c2E488b33924AF04BDacE19079cf",
  "0x7bAC85A8a13A4BcD8abb3eB7d6b4d632c5a57676",
  "0x6Df09E975c830ECae5bd4eD9d90f3A95a4f88012",
  "0x09023c0DA49Aaf8fc3fA3ADF34C6A7016D38D5e3",
  "0x24551a8Fb2A7211A25a17B1481f043A8a8adC7f2",
  "0xC1438AA3823A6Ba0C159CfA8D98dF5A994bA120b",
  "0x3b41D5571468904D4e53b6a8d93A6BaC43f02dC9",
  "0x1B39Ee86Ec5979ba5C322b826B3ECb8C79991699",
  "0x17D054eCac33D91F7340645341eFB5DE9009F1C1",
  "0x8a12Be339B0cD1829b91Adc01977caa5E9ac121e",
  "0x656c0544eF4C98A6a98491833A89204Abb045d6b",
  "0x656c0544eF4C98A6a98491833A89204Abb045d6b",
  "0xDaeA8386611A157B08829ED4997A8A62B557014C",
  "0x24D9aB51950F3d62E9144fdC2f3135DAA6Ce8D1B",
  "0x5f4eC3Df9cbd43714FE2740f5E3616155c5b8419",
  "0xC1438AA3823A6Ba0C159CfA8D98dF5A994bA120b",
  "0x656c0544eF4C98A6a98491833A89204Abb045d6b",
  "0x7c5d4F8345e66f68099581Db340cd65B078C41f4",
  "0x8a12Be339B0cD1829b91Adc01977caa5E9ac121e",
  "0xDC530D9457755926550b59e8ECcdaE7624181557",
  "0x82A44D92D6c329826dc557c5E1Be6ebeC5D5FeB9",
  "0x24D9aB51950F3d62E9144fdC2f3135DAA6Ce8D1B",
  "0xD6aA3D25116d8dA79Ea0246c4826EB951872e02e",
  "0x24551a8Fb2A7211A25a17B1481f043A8a8adC7f2",
  "0x6Df09E975c830ECae5bd4eD9d90f3A95a4f88012",
  "0x029849bbc0b1d93b85a8b6190e979fd38F5760E2",
  "0xdeb288F737066589598e9214E782fa5A8eD689e8",
  "0xD6aA3D25116d8dA79Ea0246c4826EB951872e02e",
  "0xDC530D9457755926550b59e8ECcdaE7624181557",
  "0xEe9F2375b4bdF6387aa8265dD4FB8F16512A1d46",
  "0x986b5E1e1755e3C2440e960477f25201B0a8bbD4",
  "0x7B922493370f15cD7ed2DC821AF0BeE43C5bC1cD",
  "0x626E3d9c178B8fbB4753722E51126653FB657712",
  "0x9D453f2Dc93E585f84FC8F619D4119Ad64EDab69",
  "0xFd6B9037C0A66c6B0C430596929974Ad12CAbba7",
  "0x7aBE3B8e26eDE2C3b5db0EbFbB0500c71AE16202",
  "0x2BbE55AC569c43f59672bCB633e69cB7BEdC0B21",
  "0x6D89Efa8C6cF8AB28Ff3C59D544d995C62CdA372",
  "0x4442F253E76152b5F9ab8B1d02C69119664f8147",
  "0xd77255ae607111Fd6F019150cC1C0890F8dE32BA",
  "0x342952b4018d8a1823d64dc4d03667329619Ff76",
  "0xBe7E0ceB8d147657636B62E5fea028dd224eee8D",
  "0x33DD93B090619040976Cbe387db1029894163Be1",
  "0x81B605fadbC74AF411e013CE9A73F759cA97a96b",
  "0xE39Aa36C862fc7AFa1051224Ef02590edFcee99C",
  "0xF27e6F4790e4Ede238B0d38A482FC1e64dF30311",
  "0x6D8923a68313993c6a34961261bF40cB902df572",
  "0xC378Ac91D1284F3B1A27c300338F3D3bBC7978D9",
  "0x59CB8A85CeADb2ff9DE9824dFb749578C901Cf9f",
  "0x365415C282Bf16623fc0C2840fcA6660e42653B0",
  "0x1f7f01D377708A34bfe226F917F06b437182E727",
  "0xc2F982446eB742DB99F2Fc63E62b3cd318129Ed8",
  "0xaa1667a7A4c7e135F0F22cD8Ad9ca99C1b3b2496",
  "0x133404753c67E824AAa5e732C72BA44883F74243",
  "0xc34A31D1337A3c18afFA27433919Bb2E1Bd8dF9F",
  "0xd86fD7e6ed7F12403E52A0CF323f0E95B1AC3433",
  "0xDa6e0E335c8f70e68462b5188fcdE81E91B81F9c",
  "0x945e249DD1653C76e374B492C878680377Ac2164",
  "0x4a91D334F704162f80aaCfCAeAc5cE6d1a9a6508",
  "0x1BcF0395c72074527a6fDe12BB6b8A14c09F3a0C",
  "0x90e6e554c24E579D8b7d8Bfd0f08DB7CCf7Bee49",
  "0xf025700e33DB35cCd35a1201bD84D39398337fFb",
  "0xfB3291314f4Eba31Cc9873e7683Bf6b0350a6102",
  "0x801897DC65f514ce6e00458eE554a75158Cd62D3",
  "0xd9dD4E8daB085B061a777FFF0537A21D7Afd65a0",
  "0x2ce52834ce100b2A19af76A6b6219E1B939C41F3",
  "0xDCe3586194d2B1e69848d64e7FA93fc1476F1514",
  "0xC2F4F19472f1586243d21D3F94a7BCe580440491",
  "0xf92dC88c1Ff320F0525cBda07557c6b779F7F079",
  "0xdb2f5c6eb2C5AA532737587508f2390B556ad82b",
  "0x1AfB142527d4807cBd65243409B9fB9a66C77d0C",
  "0xf44d8bd78D0F7614cC4d9cc52bb97dCEFEb76232",
  "0x5206Fab0C0E6Ae9736c58e3ABe44392beF2bBB44",
  "0xA573707c9cf99CC5a89E10Da56704eE81543a2b1",
  "0xb18F9fC306cedD1ad0128ABbcb85D75DabD29687",
  "0x102B9C200f4181C99a57315577bD5EBE5774a7e8",
  "0xee5f5C66fD6006483c4CF514CFCDc358Ac4A84c6",
  "0x4378a6363deE416ef23EFe846E9d051030E7c1Cc",
  "0xFF3EEb22B5E3dE6e705b44749C2559d704923FD7",
  "0x31697852a68433DbCc2Ff612c516d69E3D9bd08F",
];

const RATE_ASSETS = [
  0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1,
];

async function runAddPrimitives() {
  const resolvedValueInterpreter = await resolveAddressFromDb({ contractName: "ValueInterpreter" });

  if (!(PRIMITIVES.length === AGGREGATORS.length && AGGREGATORS.length === RATE_ASSETS.length)) {
    throw new Error("PRIMITIVES, AGGREGATORS, RATE_ASSETS must have the same length");
    }

  console.log(colors.cyan(`ValueInterpreter: ${resolvedValueInterpreter}`));
  console.log(colors.cyan(`Primitives: ${PRIMITIVES.length}, Aggregators: ${AGGREGATORS.length}, RateAssets: ${RATE_ASSETS.length}`));

  const { txHash, receipt, rpcUrl, staticResult, estimatedGas, simulation, explorerUrl, noOp } = await callContract({
    contractAddress: resolvedValueInterpreter,
    abi: VALUE_INTERPRETER_ABI,
    method: "addPrimitives",
    args: [PRIMITIVES, AGGREGATORS, RATE_ASSETS],
    noOpRevertMatchers: [/already.*primitive/i],
  });

  console.log(colors.cyan(`Using RPC: ${rpcUrl}`));
  if (simulation?.reverted) {
    console.log(colors.red(`Simulation reverted: ${simulation.reason || '<no reason provided>'}`));
    if (simulation.data) {
      console.log(colors.red(`Error data: ${simulation.data}`));
    }
    if (noOp) {
      console.log(colors.yellow("No-op: Some or all primitives already configured. Skipping transaction."));
      return;
    }
    console.log(colors.red("Aborting without sending transaction due to simulation revert."));
    return;
  }
  if (typeof staticResult !== "undefined") console.log(colors.cyan(`Static simulation result: ${JSON.stringify(staticResult)}`));
  if (typeof estimatedGas !== "undefined") console.log(colors.cyan(`Estimated gas: ${estimatedGas.toString()}`));
  console.log(colors.green(`Submitted tx: ${txHash}`));
  if (explorerUrl) console.log(colors.green(`Explorer: ${explorerUrl}`));
  console.log(colors.green(`Confirmed in block ${receipt.blockNumber}`));
}

// CLI entry
async function main() {
  await runAddPrimitives();
}

if (require.main === module) {
  main().catch((err) => {
    console.error(err);
    process.exit(1);
  });
}

module.exports = { runAddPrimitives };
